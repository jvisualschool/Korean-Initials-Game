<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>한글 초성 맞추기</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Outfit:wght@400;700;900&display=swap"
        rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary: #833ab4;
            --primary-light: #c13584;
            --secondary: #405de6;
            --accent: #fd1d1d;
            --bg-gradient: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Sans KR', 'Outfit', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-main);
            overflow-x: hidden;
            padding: 20px;
        }

        /* Animated Mesh Background */
        .mesh-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            filter: blur(100px);
            opacity: 0.5;
        }

        .mesh-circle {
            position: absolute;
            border-radius: 50%;
            animation: move linear infinite;
        }

        @keyframes move {
            from {
                transform: translate(0, 0) rotate(0deg);
            }

            to {
                transform: translate(100px, 100px) rotate(360deg);
            }
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 10px;
            letter-spacing: -1px;
            padding: 12px 30px;
            border-radius: 50px;
            background: rgba(0, 0, 0, 0.5);
            /* Dark background same as footer */
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: inline-block;
        }

        h1 span {
            background: linear-gradient(to right, #fff, #a5b4fc);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Mini Header for Game Screen */
        #mainHeader {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #mainHeader.game-active {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            opacity: 0.7;
        }

        #mainHeader.game-active h1 {
            font-size: 1.5rem;
            margin-bottom: 0;
        }

        #mainHeader.game-active .subtitle {
            font-size: 0.6rem;
            letter-spacing: 1px;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.3s, border-color 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            min-height: 140px;
            justify-content: center;
        }

        .category-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-light);
        }

        .category-card i {
            width: 40px;
            height: 40px;
            color: var(--primary-light);
        }

        .category-card span {
            font-weight: 700;
            font-size: 1.2rem;
        }

        /* Game Screen */
        #gameScreen {
            display: none;
            opacity: 0;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .back-btn:hover {
            color: white;
        }

        .score-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            color: #fbbf24;
        }

        .hint-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 24px;
            padding: 40px 25px 25px;
            /* Added top padding for the label */
            margin-bottom: 30px;
            margin-top: 20px;
            /* Added margin for floating label */
            text-align: center;
            border: 1px dashed var(--glass-border);
            position: relative;
            min-height: 100px;
        }

        .hint-label {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: #0f172a;
            padding: 6px 24px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 900;
            letter-spacing: 2px;
            box-shadow: 0 4px 12px rgba(0, 242, 254, 0.3);
            white-space: nowrap;
        }

        .hint-text {
            font-size: 2.2rem;
            /* Adjusted for better one-line fit */
            font-weight: 500;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            display: block;
        }

        .chosung-display {
            font-size: 5rem;
            font-weight: 900;
            text-align: center;
            margin: 40px 0;
            letter-spacing: 20px;
            padding-left: 20px;
            /* Offset for letter-spacing */
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
            font-family: 'Noto Sans KR';
        }

        .answer-display {
            font-size: 4.5rem;
            font-weight: 900;
            text-align: center;
            color: #00f2fe;
            /* Same as HINT label background color */
            margin: 40px auto 20px;
            min-height: 120px;
            width: fit-content;
            padding: 10px 40px;
            background: rgba(0, 0, 0, 0.4);
            /* 20% Darker background */
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 60px;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: relative;
            transform: scale(0);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .answer-display::after {
            content: '';
            position: absolute;
            top: -15px;
            /* Moved to top */
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 15px 15px 15px;
            /* Inverted for top position */
            border-style: solid;
            border-color: transparent transparent rgba(0, 0, 0, 0.4) transparent;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border-radius: 18px;
            border: none;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .btn-primary,
        .btn-success {
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #f1f5f9;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .btn:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .progress-container {
            margin-top: 30px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .progress-bar-bg {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--secondary), var(--primary-light));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 2.2rem;
            }

            .chosung-display {
                font-size: 3.5rem;
                letter-spacing: 12px;
            }

            .answer-display {
                font-size: 3.3rem;
                padding: 10px 30px;
                min-height: 90px;
            }

            .category-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                flex-direction: column;
            }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            color: white;
            transition: all 0.3s;
        }

        /* Sound Toggle Adjustment */
        .sound-toggle {
            position: fixed;
            top: 80px;
            /* Moved down to avoid overlapping with theme toggle */
            right: 20px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            color: white;
        }

        /* Footer */
        .footer {
            margin-top: 30px;
            width: 100%;
            max-width: 800px;
            z-index: 10;
        }

        .footer-content {
            background: rgba(0, 0, 0, 0.5);
            /* 50% Darker background box */
            padding: 12px 30px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            font-size: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .footer-content span {
            opacity: 0.8;
        }

        .footer-content .sep {
            opacity: 0.2;
        }

        .footer-content .info-trigger {
            cursor: pointer;
            margin-right: 10px;
            color: #4facfe;
            transition: transform 0.3s;
            width: 16px;
            /* 20% smaller than default 20px */
            height: 16px;
        }

        .footer-content .info-trigger:hover {
            transform: scale(1.2);
        }

        /* Splash Modal */
        .splash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            /* Changed via JS */
            justify-content: center;
            align-items: center;
            opacity: 0;
        }

        .splash-content {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 0 0 15px 0;
            /* Bottom padding reduced to 15px */
            border-radius: 40px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            /* To clip image corners */
        }

        .splash-image {
            width: 100%;
            height: 60%;
            /* 60% of modal height */
            object-fit: cover;
            margin-bottom: 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .splash-text-area {
            height: 40%;
            /* 40% of modal height */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 25px 30px 30px;
        }

        .splash-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .splash-title {
            font-size: 1.4rem;
            font-weight: 900;
            margin: 0;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .splash-content .subtitle {
            font-size: 0.65rem;
            margin: 0;
            white-space: nowrap;
        }

        .splash-footer-info {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.8;
            margin-bottom: 10px;
            /* Added spacing before button */
        }

        .splash-footer-info a {
            color: inherit;
            text-decoration: none;
            transition: color 0.3s;
        }

        .splash-footer-info a:hover {
            color: #4facfe;
        }

        .splash-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 30px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .splash-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .footer-content a {
            color: inherit;
            text-decoration: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
        }

        .footer-content a:hover {
            color: #4facfe;
            opacity: 1;
        }

        .footer-content strong a {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
        }

        .footer-content strong a:hover {
            color: #00f2fe;
        }
    </style>
</head>

<body>
    <div class="mesh-bg" id="meshBg"></div>

    <div class="container" id="mainContainer">
        <!-- Main Logo / Header -->
        <header id="mainHeader">
            <h1 id="mainTitle"><span>한글 초성 맞추기</span></h1>
            <p class="subtitle">KOREAN INITIALS GAME</p>
        </header>

        <!-- Category Selection -->
        <div id="categoryScreen">
            <div class="category-grid" id="categoryGrid">
                <!-- Category Cards Added by JS -->
            </div>

            <!-- Footer (Main Screen Only) -->
            <footer class="footer">
                <div class="footer-content">
                    <i data-lucide="book" class="info-trigger" onclick="openSplash()"></i>
                    <a href="https://gsap.com/" target="_blank"><span>GSAP</span></a>
                    <span class="sep">|</span>
                    <a href="https://github.com/catdad/canvas-confetti" target="_blank"><span>Canvas-Confetti</span></a>
                    <span class="sep">|</span>
                    <a href="https://lucide.dev/" target="_blank"><span>Lucide Icons</span></a>
                    <span class="sep">|</span>
                    <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript" target="_blank"><span>Vanilla
                            JS</span></a>
                    <span class="sep">|</span>
                    <strong><a href="mailto:jvisualschool@gmail.com">Created by Jinho Jung &copy; 2026</a></strong>
                </div>
            </footer>
        </div>

        <!-- Game Play Screen -->
        <div id="gameScreen">
            <div class="top-bar">
                <button class="back-btn" onclick="backToCategories()">
                    <i data-lucide="chevron-left"></i> 목록으로
                </button>
            </div>

            <div class="hint-container">
                <div class="hint-label">HINT</div>
                <div class="hint-text" id="hintDisplay">힌트가 여기에 표시됩니다.</div>
            </div>

            <div class="chosung-display" id="chosungDisplay">ㄱ ㄴ ㄷ</div>

            <div class="answer-display" id="answerDisplay">정답!</div>

            <div class="controls">
                <button class="btn btn-primary" onclick="showAnswer()" id="solveBtn">
                    <i data-lucide="eye"></i> 정답 확인
                </button>
                <button class="btn btn-success" onclick="nextQuestion()">
                    <i data-lucide="skip-forward"></i> 다음 문제
                </button>
            </div>

            <div class="progress-container">
                <div class="progress-text">
                    <span id="categoryLabel">카테고리</span>
                    <span id="progressText">1 / 10</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="theme-toggle" onclick="nextTheme()" title="배경 변경">
        <i data-lucide="palette"></i>
    </div>

    <div class="sound-toggle" onclick="toggleSound()">
        <i data-lucide="volume-2" id="soundIcon"></i>
    </div>

    <!-- Splash Modal -->
    <div class="splash-overlay" id="splashModal">
        <div class="splash-content">
            <img src="splash.jpg" alt="Splash" class="splash-image">
            <div class="splash-text-area">
                <div class="splash-header">
                    <h2 class="splash-title">한글 초성 맞추기</h2>
                    <p class="subtitle">KOREAN INITIALS GAME</p>
                </div>
                <div class="splash-footer-info">
                    <a href="https://gsap.com/" target="_blank">GSAP</a> |
                    <a href="https://github.com/catdad/canvas-confetti" target="_blank">Canvas-Confetti</a> |
                    <a href="https://lucide.dev/" target="_blank">Lucide Icons</a> |
                    <a href="https://developer.mozilla.org/ko/docs/Web/JavaScript" target="_blank">Vanilla JS</a><br>
                    <span style="font-weight: 300;"><a href="mailto:jvisualschool@gmail.com">Created by Jinho Jung
                            &copy; 2026</a></span>
                </div>
                <button class="splash-close" onclick="closeSplash()">시작하기</button>
            </div>
        </div>
    </div>

    <script src="words.js"></script>

    <script>
        const categories = [
            { id: '나라', name: '나라 이름', icon: 'globe' },
            { id: '음식', name: '맛있는 음식', icon: 'utensils' },
            { id: '동물', name: '귀여운 동물', icon: 'dog' },
            { id: '영화', name: '명작 영화', icon: 'film' },
            { id: '스포츠', name: '열정 스포츠', icon: 'trophy' },
            { id: '직업', name: '다양한 직업', icon: 'briefcase' },
            { id: '과일', name: '상큼한 과일', icon: 'apple' }
        ];

        // Sound Paths (Absolute paths as confirmed)
        const SOUND_PATHS = {
            yes: './public/MP3/yes.mp3',
            no: './public/MP3/no.mp3',
            congrat: './public/MP3/congrat.mp3',
            bgm: Array.from({ length: 5 }, (_, i) => `./public/MP3/bgm${i + 1}.mp3`)
        };

        const themes = [
            {
                name: 'Default',
                bg: 'linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%)',
                colors: ['#405de6', '#833ab4', '#c13584', '#fd1d1d', '#5851db']
            },
            {
                name: 'Arctic Aurora',
                bg: 'linear-gradient(135deg, #020111 0%, #02130b 100%)',
                colors: ['#00f2fe', '#4facfe', '#667eea', '#764ba2', '#00b894']
            },
            {
                name: 'Neon Midnight',
                bg: 'linear-gradient(135deg, #000000 0%, #1a1a1a 100%)',
                colors: ['#ff007f', '#7f00ff', '#007fff', '#00ff7f', '#ffff00']
            }
        ];

        let currentThemeIndex = 0;

        let gameState = {
            category: '',
            words: [],
            index: 0,
            score: 0,
            isShowingAnswer: false,
            soundEnabled: true,
            bgm: null
        };

        // Initialize
        async function init() {
            createMeshBG();
            renderCategories();

            // Word data is now pre-loaded via words.js script tag
            if (typeof wordData === 'undefined') {
                console.error("데이터 로딩 실패: words.js 파일을 찾을 수 없습니다.");
            }

            // GSAP Intro with slight delay to ensure rendering
            setTimeout(() => {
                gsap.fromTo("#mainHeader",
                    { y: -30, opacity: 0 },
                    { y: 0, opacity: 1, duration: 0.8, ease: "power3.out" }
                );

                const cards = document.querySelectorAll(".category-card");
                if (cards.length > 0) {
                    gsap.fromTo(cards,
                        { scale: 0.8, opacity: 0 },
                        { scale: 1, opacity: 1, duration: 0.5, stagger: 0.05, ease: "back.out(1.7)" }
                    );
                }
                lucide.createIcons();
            }, 100);
        }

        function createMeshBG() {
            const mesh = document.getElementById('meshBg');
            mesh.innerHTML = ''; // Clear previous circles

            const theme = themes[currentThemeIndex];
            document.body.style.background = theme.bg;
            document.body.style.backgroundAttachment = 'fixed';

            for (let i = 0; i < 6; i++) {
                const circle = document.createElement('div');
                circle.className = 'mesh-circle';
                const size = Math.random() * 400 + 200;
                circle.style.width = size + 'px';
                circle.style.height = size + 'px';
                circle.style.background = theme.colors[i % theme.colors.length];
                circle.style.left = Math.random() * 100 + '%';
                circle.style.top = Math.random() * 100 + '%';
                circle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                circle.style.animationDelay = (Math.random() * -20) + 's';
                mesh.appendChild(circle);
            }
        }

        function nextTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            createMeshBG();

            // Notification toast for theme change (optional)
            console.log(`Theme changed to: ${themes[currentThemeIndex].name}`);
        }

        function renderCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = categories.map(cat => `
                <div class="category-card" onclick="startGame('${cat.id}')">
                    <i data-lucide="${cat.icon}"></i>
                    <span>${cat.name}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function startGame(categoryId) {
            if (!wordData) {
                alert("데이터가 아직 로드되지 않았습니다.");
                return;
            }
            playSound('yes');
            startBGM();

            gameState.category = categoryId;
            gameState.words = [...wordData[categoryId]].sort(() => Math.random() - 0.5);
            gameState.index = 0;
            gameState.score = 0;
            gameState.isShowingAnswer = false;

            document.getElementById('mainHeader').classList.add('game-active');
            document.getElementById('categoryLabel').textContent = categories.find(c => c.id === categoryId).name;

            // Transition
            gsap.to("#categoryScreen", {
                opacity: 0, x: -20, duration: 0.4, onComplete: () => {
                    document.getElementById('categoryScreen').style.display = 'none';
                    document.getElementById('gameScreen').style.display = 'block';
                    gsap.to("#gameScreen", { opacity: 1, x: 0, duration: 0.4 });
                    displayQuestion();
                }
            });
        }

        function getChosung(word) {
            const chosungList = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];
            let result = '';
            for (let i = 0; i < word.length; i++) {
                const code = word.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) {
                    result += chosungList[Math.floor(code / 588)];
                } else {
                    result += word[i];
                }
            }
            return result.split('').join(' ');
        }

        function displayQuestion() {
            const item = gameState.words[gameState.index];
            document.getElementById('hintDisplay').textContent = item.hint;
            document.getElementById('chosungDisplay').textContent = getChosung(item.word);
            document.getElementById('answerDisplay').textContent = '';
            gsap.killTweensOf("#answerDisplay"); // Stop previous floating
            gsap.set("#answerDisplay", { scale: 0, y: 0, rotation: 0 });

            // Progress Update
            const prog = ((gameState.index + 1) / gameState.words.length) * 100;
            document.getElementById('progressBar').style.width = prog + '%';
            document.getElementById('progressText').textContent = `${gameState.index + 1} / ${gameState.words.length}`;

            // Micro-interaction: Pop chosung
            gsap.fromTo("#chosungDisplay",
                { scale: 0.8, opacity: 0 },
                { scale: 1, opacity: 1, duration: 0.6, ease: "back.out(2)" }
            );

            gameState.isShowingAnswer = false;
        }

        function showAnswer() {
            if (gameState.isShowingAnswer) return;

            gameState.isShowingAnswer = true;
            const item = gameState.words[gameState.index];
            const answerDiv = document.getElementById('answerDisplay');
            answerDiv.textContent = item.word;

            playSound('congrat');

            // Celebration
            confetti({
                particleCount: 150,
                spread: 100,
                origin: { y: 0.6 },
                colors: ['#405de6', '#833ab4', '#c13584', '#fd1d1d', '#10b981']
            });

            // Enhanced Micro-animation
            gsap.fromTo(answerDiv,
                { scale: 0, rotation: -10, y: 20 },
                {
                    scale: 1,
                    rotation: 0,
                    y: 0,
                    duration: 0.8,
                    ease: "back.out(2.5)",
                    onComplete: () => {
                        // Floating animation
                        gsap.to(answerDiv, {
                            y: -10,
                            duration: 1.5,
                            repeat: -1,
                            yoyo: true,
                            ease: "sine.inOut"
                        });
                    }
                }
            );

            gameState.score += 10;
        }

        function nextQuestion() {
            if (gameState.index < gameState.words.length - 1) {
                gameState.index++;
                displayQuestion();
            } else {
                alert(`게임 클리어! 최종 점수: ${gameState.score}`);
                backToCategories();
            }
        }

        function backToCategories() {
            stopBGM();
            document.getElementById('mainHeader').classList.remove('game-active');
            gsap.to("#gameScreen", {
                opacity: 0, x: 20, duration: 0.4, onComplete: () => {
                    document.getElementById('gameScreen').style.display = 'none';
                    document.getElementById('categoryScreen').style.display = 'block';
                    gsap.to("#categoryScreen", { opacity: 1, x: 0, duration: 0.4 });
                }
            });
        }

        // Sound Engine
        function playSound(type) {
            if (!gameState.soundEnabled) return;
            const audio = new Audio(SOUND_PATHS[type]);
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Sound play error", e));
        }

        function startBGM() {
            if (!gameState.soundEnabled) return;
            if (gameState.bgm) gameState.bgm.pause();

            const randomBgm = SOUND_PATHS.bgm[Math.floor(Math.random() * 5)];
            gameState.bgm = new Audio(randomBgm);
            gameState.bgm.loop = true;
            gameState.bgm.volume = 0.2;
            gameState.bgm.play().catch(e => console.log("BGM play error", e));
        }

        function stopBGM() {
            if (gameState.bgm) {
                gameState.bgm.pause();
                gameState.bgm = null;
            }
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            const icon = document.getElementById('soundIcon');
            if (gameState.soundEnabled) {
                icon.setAttribute('data-lucide', 'volume-2');
                if (gameState.category && !gameState.bgm) startBGM();
            } else {
                icon.setAttribute('data-lucide', 'volume-x');
                stopBGM();
            }
            lucide.createIcons();
        }

        // Splash Logic
        function openSplash() {
            const modal = document.getElementById('splashModal');
            modal.style.display = 'flex';
            gsap.to(modal, { opacity: 1, duration: 0.5 });
            gsap.from(".splash-content", { scale: 0.8, opacity: 0, duration: 0.5, ease: "back.out(1.7)" });
        }

        function closeSplash() {
            const modal = document.getElementById('splashModal');
            gsap.to(modal, {
                opacity: 0,
                duration: 0.4,
                onComplete: () => {
                    modal.style.display = 'none';
                }
            });
        }

        window.onload = init;
    </script>
</body>

</html>